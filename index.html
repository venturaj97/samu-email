<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificador Inteligente de Emails</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Pequenos ajustes visuais */
        body {
            background-color: #f0f2f5; /* Um cinza mais suave */
        }
        .container {
            max-width: 750px;
        }
        .card {
            border: none;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        .card-title {
            color: #333;
        }
        .btn-primary {
            background-color: #0056b3;
            border: none;
        }
        .btn-primary:hover {
            background-color: #004494;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="card p-4 p-md-5">
            <div class="card-body">
                <h2 class="card-title text-center mb-3">Analisador de Produtividade de Emails</h2>
                <p class="text-muted text-center mb-4">
                    Insira o texto de um email ou faça o upload de um arquivo para análise.
                </p>
                
                <form id="emailForm">
                    <div class="mb-3">
                        <label for="email_text" class="form-label fw-bold">Cole o conteúdo do email:</label>
                        <textarea class="form-control" id="email_text" name="email_text" rows="8" placeholder="Prezado(a), gostaria de saber o status da minha solicitação..."></textarea>
                    </div>
                    
                    <div class="text-center my-3 text-muted">
                        <small>OU</small>
                    </div>

                    <div class="mb-4">
                        <label for="email_file" class="form-label fw-bold">Faça o upload de um arquivo:</label>
                        <input 
                            class="form-control" 
                            type="file" 
                            id="email_file" 
                            name="email_file"
                            accept=".txt,.pdf,.eml,.msg">
                        <div class="form-text">Formatos suportados: TXT, PDF, EML e MSG.</div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            Analisar Agora
                        </button>
                    </div>
                </form>

                <div id="resultArea" class="mt-5" style="display: none;">
                    <hr>
                    <h3 class="text-center mb-4">Resultado da Análise</h3>
                    <div id="resultAlert" class="alert" role="alert">
                        <h4 class="alert-heading">Categoria: <span id="categoria" class="fw-bold"></span></h4>
                    </div>
                    
                    <h5>Resposta Automática Sugerida:</h5>
                    <div class="p-3 bg-light border rounded">
                        <p id="resposta" class="mb-0"></p>
                    </div>
                </div>

            </div>
        </div>
        <footer class="text-center text-muted mt-4">
            <p>&copy; 2025 - Solução com FastAPI & IA</p>
        </footer>
    </div>

    <script>

        // Seleciona o formulário pelo ID
    const form = document.getElementById('emailForm');
    
    // Seleciona os elementos da área de resultado para podermos atualizá-los
    const resultArea = document.getElementById('resultArea');
    const resultAlert = document.getElementById('resultAlert');
    const categoriaSpan = document.getElementById('categoria');
    const respostaP = document.getElementById('resposta');
    
    // Adiciona um "ouvinte" para o evento de 'submit' do formulário
    form.addEventListener('submit', async function(event) {
        // Previne o comportamento padrão do formulário (que é recarregar a página)
        event.preventDefault();

        // Pega o botão e o spinner (ícone de carregamento)
        const button = form.querySelector('button[type="submit"]');
        const spinner = document.createElement('span');
        spinner.className = 'spinner-border spinner-border-sm me-2';
        spinner.setAttribute('role', 'status');
        spinner.setAttribute('aria-hidden', 'true');

        // Mostra o estado de "carregando"
        button.disabled = true;
        button.prepend(spinner);
        resultArea.style.display = 'none';

        // Cria um objeto FormData com os dados do formulário (texto e arquivo)
        const formData = new FormData(form);

        try {
            // Faz a requisição para o nosso backend FastAPI
            const response = await fetch('http://127.0.0.1:8000/processar/', {
                method: 'POST',
                body: formData, // Envia os dados do formulário
            });

            const data = await response.json();

            if (!response.ok) {
                // Se a API retornar um erro (ex: 400, 500), exibe o erro
                throw new Error(data.detail || 'Ocorreu um erro desconhecido.');
            }

            // Se a requisição for um sucesso, atualiza a página com os resultados
            categoriaSpan.textContent = data.categoria;
            respostaP.textContent = data.resposta_sugerida;

            // Muda a cor do alerta com base na categoria
            resultAlert.classList.remove('alert-success', 'alert-warning', 'alert-danger');
            if (data.categoria === 'Produtivo') {
                resultAlert.classList.add('alert-success');
            } else {
                resultAlert.classList.add('alert-warning');
            }
            
            // Exibe a área de resultados
            resultArea.style.display = 'block';

        } catch (error) {
            // Se ocorrer qualquer erro na comunicação, exibe um alerta
            console.error('Erro na requisição:', error);
            alert('Erro: ' + error.message);
        } finally {
            // Este bloco sempre executa, seja com sucesso ou erro
            // Remove o spinner e reabilita o botão
            button.disabled = false;
            button.removeChild(spinner);
        }
    });
    </script>
</body>
</html>